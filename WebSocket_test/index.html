<!DOCTYPE html>
<html>
    <head>
        <title>Messing around with WebSockets :^)</title>
        <meta charset="utf-8">
        <script>
            window.onload = function()
            {
                var count = Math.floor((Math.random() * 1000)) % 10;
                var ws = new WebSocket("ws://127.0.0.1");
                console.log("Will send " + (count + 1) + " messages\n");
                
                function testSendText()
                {
                    ws.send(Date.now() + ': =)/');
                }
                
                ws.onopen = function()
                {
                    console.log("Connection established!");
                    testSendText();
                }
                ws.onerror = function()
                {
                    console.error("Connection failed, DAH!");
                }
                ws.onclose = function()
                {
                    console.warn("Connection closed.");
                }
                ws.onmessage = function(msgEvt)
                {
                    var elem = document.createElement('DIV');
                    elem.innerText = msgEvt.data;
                    document.getElementById('response').appendChild(elem);
                    if (count-- > 0) testSendText();
                    else ws.close();
                }
                console.log(ws);
            }
        </script>
    </head>
    <body>
        <h2>Look at the console ( ͡°ل͜ ͡°)</h2>
        <p id="response"></p>
    </body>
</html>